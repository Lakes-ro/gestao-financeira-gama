<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Financeiro Pro - Cliente</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="icon" type="image/png" href="logo.png">
</head>
<body>
<div class="app-container">
    <div id="loginClientScreen" class="screen screen--centered active">
        <div class="login-box">
            <h1 class="login-box__title">ğŸ’° Gestor Financeiro</h1>
            <p class="login-box__subtitle">Acesso do Cliente</p>
            <form onsubmit="clientLogin(event)">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="clientEmail" placeholder="seu@email.com" required>
                </div>
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" id="clientPassword" placeholder="Digite sua senha" required>
                </div>
                <button type="submit" class="btn btn--primary">Entrar como Cliente</button>
            </form>
            <p class="login-box__toggle-text">NÃ£o tem conta? <a href="#" onclick="uiService.showScreen('registerClientScreen'); return false;">Criar conta</a></p>
            <div id="clientLoginError" class="message message--error"></div>
        </div>
    </div>

    <div id="registerClientScreen" class="screen screen--centered">
        <div class="login-box">
            <h1 class="login-box__title">Criar Conta</h1>
            <p class="login-box__subtitle">Acesso ao seu perfil financeiro</p>
            <form onsubmit="clientRegister(event)">
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="clientRegEmail" placeholder="seu@email.com" required>
                </div>
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" id="clientRegPassword" placeholder="MÃ­nimo 6 caracteres" required>
                </div>
                <button type="submit" class="btn btn--primary">Criar Conta</button>
            </form>
            <p class="login-box__toggle-text">JÃ¡ tem conta? <a href="#" onclick="uiService.showScreen('loginClientScreen'); return false;">Fazer login</a></p>
            <div id="clientRegisterError" class="message message--error"></div>
        </div>
    </div>

    <div id="clientScreen" class="screen layout-wrapper">
        <aside class="sidebar">
            <div class="sidebar__header"><h2>ğŸ“Š Menu</h2></div>
            <nav class="sidebar__nav">
                <button class="sidebar__nav-item active" onclick="navigateClientTo('dashboardView', event)">ğŸ“ˆ Dashboard</button>
                <button class="sidebar__nav-item" onclick="navigateClientTo('transactionsView', event)">ğŸ’³ TransaÃ§Ãµes</button>
                <button class="sidebar__nav-item" onclick="navigateClientTo('goalsView', event)">ğŸ¯ Metas</button>
                <button class="sidebar__nav-item" onclick="navigateClientTo('planningView', event)">ğŸ“‹ Planejamento</button>
            </nav>
            <div class="sidebar__footer">
                <button class="sidebar__profile" onclick="showClientProfile()">ğŸ‘¤ Perfil</button>
                <button onclick="logoutClient()" class="btn btn--logout-small">Sair</button>
            </div>
        </aside>

        <main class="main-content">
            <header class="client-header">
                <h1>ğŸ‘‹ Bem-vindo, <span id="clientNameDisplay"></span></h1>
                <p>Organize sua vida financeira de forma simples.</p>
            </header>

            <section id="dashboardView" class="view-section active">
                <div class="card">
                    <h3>ğŸ“Š Resumo do MÃªs</h3>
                    <div class="resume-grid">
                        <div class="resume-item receita"><span class="label">Receitas</span><span class="value" id="totalReceitas">R$ 0,00</span></div>
                        <div class="resume-item despesa"><span class="label">Despesas</span><span class="value" id="totalDespesas">R$ 0,00</span></div>
                        <div class="resume-item saldo"><span class="label">Saldo</span><span class="value" id="saldo">R$ 0,00</span></div>
                    </div>
                </div>

                <div id="mentorDiagnosisCard" class="card hidden" style="border-left: 4px solid #ffd700;">
                    <h3 style="color: #ffd700;">ğŸ’¬ DiagnÃ³stico do Mentor</h3>
                    <div id="mentorDiagnosisText" style="color: #e0e0e0; font-size: 13px; line-height: 1.6; white-space: pre-wrap; background: rgba(255, 215, 0, 0.05); padding: 15px; border-radius: 8px;"></div>
                </div>

                <div class="card">
                    <h3>ğŸ¯ AnÃ¡lise Financeira</h3>
                    <div class="bi-grid">
                        <div class="bi-item">
                            <span class="bi-label">Custo de SobrevivÃªncia</span>
                            <span class="bi-value" id="biSurvivalCost">R$ 0,00</span>
                            <span class="bi-detail" id="biSurvivalPercent">-</span>
                        </div>
                        <div class="bi-item">
                            <span class="bi-label">Estilo de Vida</span>
                            <span class="bi-value" id="biLifestyleCost">R$ 0,00</span>
                            <span class="bi-detail" id="biLifestylePercent">-</span>
                        </div>
                        <div class="bi-item">
                            <span class="bi-label">Renda Passiva</span>
                            <span class="bi-value" id="biPassiveIncome">R$ 0,00</span>
                            <span class="bi-detail" id="biPassiveCoverage">0%</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ“ˆ Fundo de EmergÃªncia</h3>
                    <div style="padding: 20px; background: linear-gradient(135deg, rgba(100, 255, 122, 0.1) 0%, rgba(100, 150, 255, 0.1) 100%); border: 1px solid rgba(100, 150, 255, 0.3); border-radius: 8px; text-align: center;">
                        <p style="color: #a0a0b0; font-size: 13px; margin-bottom: 10px;">SALDO DO MÃŠS:</p>
                        <h2 id="clientPlanningBalanceText" style="color: #64ff7a; font-size: 32px; font-weight: 800; margin-bottom: 20px;">R$ 0,00</h2>
                        <p style="color: #a0a0b0; font-size: 13px; margin-bottom: 10px; margin-top: 20px;">SUA RESERVA DE EMERGÃŠNCIA IDEAL:</p>
                        <h2 id="clientEmergencyFund" style="color: #64ff7a; font-size: 32px; font-weight: 800;">R$ 0,00</h2>
                    </div>
                </div>
            </section>

            <section id="transactionsView" class="view-section">
                <div class="card">
                    <h3>â• AdiÃ§Ã£o RÃ¡pida</h3>
                    <form onsubmit="handleAddTransaction(event)">
                        <div class="form-group">
                            <label>Categoria:</label>
                            <select id="transCategory" required>
                                <option value="">Carregando...</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Valor (R$):</label>
                                <input type="number" id="transValue" placeholder="0,00" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label>Data:</label>
                                <input type="date" id="transDate" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>DescriÃ§Ã£o:</label>
                            <input type="text" id="transDescription" placeholder="DescriÃ§Ã£o (opcional)">
                        </div>
                        <button type="submit" class="btn btn--primary">Registrar</button>
                    </form>
                    <div id="transError" class="message message--error"></div>
                    <div id="transSuccess" class="message message--success"></div>
                </div>

                <div class="card">
                    <h3>ğŸ“‹ HistÃ³rico</h3>
                    <button class="btn-collapse" onclick="toggleCollapse('transactionHistory')">ğŸ“‚ Visualizar <span class="collapse-icon">â–¼</span></button>
                    <div id="transactionHistory" class="collapse-content hidden">
                        <div id="transactionHistoryList" class="transactions-list"><p class="empty-state">Nenhuma transaÃ§Ã£o registrada</p></div>
                    </div>
                </div>
            </section>

            <section id="goalsView" class="view-section">
                <div class="card">
                    <h3>ğŸ¯ Minhas Metas</h3>
                    <button onclick="uiService.toggle('addMetaForm')" class="btn btn--secondary">+ Adicionar Meta</button>
                    <div id="addMetaForm" class="hidden" style="margin-top: 15px; padding: 15px; background: rgba(100, 150, 255, 0.1); border-radius: 8px;">
                        <form onsubmit="handleAddMeta(event)">
                            <div class="form-group">
                                <label>Nome da Meta:</label>
                                <input type="text" id="metaName" placeholder="Ex: Comprar notebook" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Valor NecessÃ¡rio (R$):</label>
                                    <input type="number" id="metaValue" placeholder="0,00" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label>Prazo (meses):</label>
                                    <input type="number" id="metaPrazo" placeholder="6" min="1" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn--primary">Criar Meta</button>
                        </form>
                    </div>
                    <div id="clientMetasList" class="metas-client-grid" style="margin-top: 20px;"><p class="empty-state">Nenhuma meta criada</p></div>
                </div>
            </section>

            <section id="planningView" class="view-section">
                <div class="card">
                    <h3>ğŸ“Š Planejamento Personalizado</h3>
                    <div style="padding: 15px; background: rgba(100, 150, 255, 0.1); border-radius: 8px; text-align: center; color: #6b7c8f;">
                        <p>Aguardando planejamento personalizado do administrador...</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="clientProfileModal" class="modal hidden">
        <div class="modal__content">
            <header class="modal__header">
                <h2>ğŸ‘¤ Meu Perfil</h2>
                <button onclick="uiService.closeModal('clientProfileModal')" class="modal__close-btn">âœ•</button>
            </header>
            <div class="modal__body">
                <div style="background: rgba(100, 150, 255, 0.1); padding: 20px; border-radius: 8px;">
                    <p style="color: #a0a0b0; font-size: 12px; margin-bottom: 8px;">Nome</p>
                    <p id="profileClientName" style="color: #fff; font-size: 18px; font-weight: 700;"></p>
                    <p style="color: #a0a0b0; font-size: 12px; margin: 15px 0 8px 0;">Email</p>
                    <p id="profileClientEmail" style="color: #6495ff; font-size: 14px;"></p>
                </div>
                <button onclick="logoutClient()" class="btn btn--logout" style="width: 100%; margin-top: 20px;">Sair</button>
            </div>
        </div>
    </div>

    <div id="editMetaModal" class="modal hidden">
        <div class="modal__content">
            <header class="modal__header">
                <h2>âœï¸ <span id="metaEditName"></span></h2>
                <button onclick="uiService.closeModal('editMetaModal')" class="modal__close-btn">âœ•</button>
            </header>
            <div class="modal__body">
                <div style="background: rgba(100, 150, 255, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <p style="color: #a0a0b0; font-size: 12px; margin-bottom: 5px;">Meta</p>
                            <p id="metaEditGoal" style="color: #6495ff; font-weight: 700;">R$ 0,00</p>
                        </div>
                        <div>
                            <p style="color: #a0a0b0; font-size: 12px; margin-bottom: 5px;">Economizado</p>
                            <p id="metaEditCurrent" style="color: #64ff7a; font-weight: 700;">R$ 0,00</p>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="height: 8px; background: rgba(100, 150, 255, 0.2); border-radius: 4px; overflow: hidden;">
                            <div id="metaEditProgressBar" style="height: 100%; background: #6495ff; width: 0%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                </div>
                <form id="editMetaForm" onsubmit="handleEditMeta(event)">
                    <div class="form-group">
                        <label>Adicionar Valor (R$):</label>
                        <input type="number" id="editMetaAddValue" placeholder="0,00" step="0.01" min="0" required>
                    </div>
                    <button type="submit" class="btn btn--primary">Registrar</button>
                </form>
                <div id="editMetaError" class="message message--error"></div>
                <div id="editMetaSuccess" class="message message--success"></div>
            </div>
        </div>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>
